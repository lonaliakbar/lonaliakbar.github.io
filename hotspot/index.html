<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TITEK APUI | Ali Akbar Dev</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Inter:wght@400;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root { --primary: #ff4d4d; --bg: #0b0b0b; --panel-bg: rgba(20, 20, 20, 0.95); }
        body { margin: 0; padding: 0; background: var(--bg); font-family: 'Inter', sans-serif; overflow: hidden; color: white; }
        #map { height: 100vh; width: 100%; }
        
        .panel {
            position: absolute; top: 15px; left: 15px; z-index: 1000;
            background: var(--panel-bg); padding: 22px;
            border-radius: 18px; width: 300px; border: 1px solid #333;
            box-shadow: 0 15px 50px rgba(0,0,0,0.9); backdrop-filter: blur(12px);
        }

        .brand-header { border-bottom: 2px solid var(--primary); margin-bottom: 18px; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: flex-start; }
        .brand-header h2 { margin:0; color: #fff; font-size: 24px; letter-spacing: 2px; font-weight: 900; }
        .brand-header span { font-size: 10px; color: var(--primary); font-weight: bold; text-transform: uppercase; }

        /* Tombol Info Ikon Chip Berkedip Glow */
        .btn-info { 
            background: #111; border: 1px solid var(--primary); 
            color: var(--primary); border-radius: 50%; width: 35px; height: 35px; 
            cursor: pointer; font-size: 14px; transition: 0.3s; 
            animation: glow-pulse 1.5s infinite ease-in-out;
            display: flex; align-items: center; justify-content: center;
        }
        @keyframes glow-pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 77, 77, 0.7); transform: scale(1); }
            50% { box-shadow: 0 0 20px 5px rgba(255, 77, 77, 0.4); transform: scale(1.1); }
            100% { box-shadow: 0 0 0 0 rgba(255, 77, 77, 0); transform: scale(1); }
        }

        /* Modal Whitepaper */
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); backdrop-filter: blur(10px); }
        .modal-content { 
            background: #0f0f0f; margin: 2% auto; padding: 45px; border: 1px solid #333; 
            width: 90%; max-width: 800px; border-radius: 30px; max-height: 90vh; 
            overflow-y: auto; color: #fff; box-shadow: 0 0 50px rgba(0,0,0,1);
        }
        .close-modal { float: right; font-size: 30px; cursor: pointer; color: #555; }
        .close-modal:hover { color: var(--primary); }
        
        .modal-content h3 { font-size: 32px; font-weight: 900; margin-top: 0; color: var(--primary); letter-spacing: -1px; }
        .tech-section { margin-bottom: 30px; border-left: 2px solid #222; padding-left: 20px; }
        .tech-section h4 { font-family: 'Inter', sans-serif; color: #fff; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }
        .tech-section p { font-size: 15px; color: #aaa; line-height: 1.8; text-align: justify; }

        .signature-section { margin-top: 60px; text-align: right; border-top: 1px solid #222; padding-top: 30px; }
        .signature-name { font-family: 'Dancing Script', cursive; font-size: 50px; color: #fff; margin-top: 10px; text-shadow: 0 0 15px rgba(255,255,255,0.2); }
        .loc-stamp { font-size: 12px; color: var(--primary); font-weight: 900; text-transform: uppercase; letter-spacing: 3px; }

        /* UI elements */
        .lang-switcher { display: flex; gap: 8px; margin-bottom: 15px; }
        .lang-btn { flex: 1; padding: 8px; border: 1px solid #444; background: #222; color: #fff; border-radius: 6px; cursor: pointer; font-size: 11px; display: flex; align-items: center; justify-content: center; gap: 6px; }
        .lang-btn img { width: 16px; height: 12px; border-radius: 2px; object-fit: cover; }
        .lang-btn.active { background: var(--primary); border-color: var(--primary); }
        label { font-size: 10px; font-weight: bold; color: #888; text-transform: uppercase; display: block; margin-top: 10px; }
        select, .btn-main { width: 100%; padding: 12px; margin: 6px 0 10px 0; border-radius: 8px; font-family: inherit; }
        select { background: #1a1a1a; color: white; border: 1px solid #444; }
        .btn-main { background: var(--primary); color: white; border: none; cursor: pointer; font-weight: bold; }
        .stats { background: rgba(255, 77, 77, 0.05); padding: 15px; border-radius: 12px; text-align: center; border: 1px solid #333; }
        #fire-count { font-size: 36px; color: var(--primary); font-weight: 900; }
        .leaflet-popup-content-wrapper { background: #1a1a1a !important; color: white !important; border-radius: 12px; border: 1px solid #444; }
        .leaflet-popup-tip { background: #1a1a1a !important; }
        .glow-marker { filter: drop-shadow(0 0 6px var(--primary)); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 0.7; } 50% { opacity: 1; } 100% { opacity: 0.7; } }
    </style>
</head>
<body>

<div id="wpModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeWP()">&times;</span>
        <h3>INTELIJEN GEOSPASIAL: TITEK APUI</h3>
        
        <div class="tech-section">
            <h4>MATA DI CAKRAWALA</h4>
            <p>TITEK APUI bukanlah sekadar peta digital biasa. Platform ini adalah manifestasi dari teknologi pengindraan jauh yang menghubungkan perangkat Anda langsung dengan konstelasi satelit orbit rendah milik NASA yang melaju ribuan kilometer di atas permukaan bumi. Setiap piksel data yang Anda lihat adalah hasil pemindaian spektrum inframerah yang menangkap anomali panas secara presisi.</p>
        </div>

        <div class="tech-section">
            <h4>KEKUATAN RADIOMETRIK</h4>
            <p>Sistem ini mampu membedakan intensitas energi yang dipancarkan oleh api melalui perhitungan <b>Fire Radiative Power (FRP)</b>. Dengan memproses sensor VIIRS dan MODIS, TITEK APUI mendeteksi radiasi termal hingga skala Megawatt, memberikan informasi tentang seberapa besar energi panas yang sedang dilepaskan ke atmosfer bumi dalam waktu yang hampir bersamaan dengan kejadian aslinya.</p>
        </div>

        <div class="tech-section">
            <h4>NAVIGASI CERDAS & RESPONSIF</h4>
            <p>Melalui integrasi mesin pencari lokasi otomatis, sistem ini mampu menerjemahkan koordinat GPS mentah menjadi nama wilayah administratif secara instan. Dirancang dengan arsitektur yang ringan namun tangguh, TITEK APUI memastikan sinkronisasi data tetap berjalan mulus tanpa mengganggu pengalaman visual Anda, memberikan navigasi yang presisi di mana pun titik api berada.</p>
        </div>

        <div class="tech-section">
            <h4>DEDIKASI UNTUK KEMANUSIAAN</h4>
            <p>Platform ini dibangun sebagai alat bantu krusial dalam mitigasi bencana. Menyatukan teknologi canggih dengan kemudahan akses, TITEK APUI berdiri sebagai garda terdepan informasi untuk menjaga kelestarian alam dan keselamatan masyarakat dari ancaman kebakaran hutan dan lahan.</p>
        </div>

        <div class="signature-section">
            <div class="loc-stamp">DEVELOPED BY CHIEF ENGINEER AT:</div>
            <div style="color:#fff; font-weight:900; font-size:16px;">COT MESJID, SAMATIGA</div>
            <div class="signature-name">Ali Akbar</div>
        </div>
    </div>
</div>

<div class="panel">
    <div class="brand-header">
        <div>
            <span id="dev-tag">ENGINEERED BY ALI AKBAR</span>
            <h2>TITEK APUI</h2>
        </div>
        <button class="btn-info" onclick="openWP()"><i class="fas fa-microchip"></i></button>
    </div>

    <div class="lang-switcher">
        <button class="lang-btn active" id="btn-ace" onclick="setLang('ace')">
            <img src="https://flagcdn.com/w40/tr.png"> ACE
        </button>
        <button class="lang-btn" id="btn-id" onclick="setLang('id')">
            <img src="https://flagcdn.com/w40/id.png"> ID
        </button>
        <button class="lang-btn" id="btn-en" onclick="setLang('en')">
            <img src="https://flagcdn.com/w40/us.png"> EN
        </button>
    </div>
    
    <label id="lbl-region">WILAYAH</label>
    <select id="region-select" onchange="updateData()">
        <option value="aceh">Aceh</option>
        <option value="indonesia">Indonesia</option>
        <option value="dunia">Global</option>
    </select>

    <label id="lbl-sat">SATELIT NASA</label>
    <select id="sat-source" onchange="updateData()">
        <option value="viirs_snpp">VIIRS SNPP (High Res)</option>
        <option value="modis">MODIS (Aqua/Terra)</option>
        <option value="noaa20">NOAA-20 (J1)</option>
        <option value="noaa21">NOAA-21 (J2)</option>
    </select>

    <div class="stats">
        <div id="fire-count">0</div>
        <div id="lbl-hotspot">TITIK API TERDETEKSI</div>
    </div>

    <p id="status" style="font-size:11px; text-align:center; color:#888; margin: 12px 0;">Connecting...</p>
    <button class="btn-main" onclick="updateData()"><i class="fas fa-sync-alt"></i> REFRESH DATA</button>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

<script>
    const gasApiUrl = "https://script.google.com/macros/s/AKfycbzZs31kL9CefrJCCE5h6fqluhNwVnSkCfIZ-kc5K62mn85Du1WJpC3BWWZOXzn81C3S/exec"; 
    let currentLang = 'ace';
    let fireLayer = L.layerGroup();

    const translations = {
        ace: { dev: "GEUPEUGET LÃ‰ ALI AKBAR", region: "WILAYAH", sat: "SATELIT NASA", hotspot: "TITEK APUI TEUDETEKSI", refresh: "PEUBARÃ” DATA", sync: "Sinkron...", detail: "ðŸ”¥ DETIL TITEK APUI", temp: "Suum", energy: "Energi", time: "Watee", loc_loading: "ðŸ“ Mita alamat...", coord: "Koordinat" },
        id: { dev: "DIKEMBANGKAN OLEH ALI AKBAR", region: "WILAYAH PANTUAN", sat: "SUMBER SATELIT", hotspot: "TITIK API TERDETEKSI", refresh: "PERBARUI DATA", sync: "Sinkronisasi...", detail: "ðŸ”¥ DETAIL HOTSPOT", temp: "Suhu", energy: "Energi (FRP)", time: "Waktu", loc_loading: "ðŸ“ Mencari alamat...", coord: "Koordinat" },
        en: { dev: "ENGINEERED BY ALI AKBAR", region: "MONITORING REGION", sat: "SATELLITE SOURCE", hotspot: "HOTSPOTS DETECTED", refresh: "REFRESH DATA", sync: "Syncing...", detail: "ðŸ”¥ HOTSPOT DETAILS", temp: "Temperature", energy: "Energy (FRP)", time: "Time", loc_loading: "ðŸ“ Fetching address...", coord: "Coordinates" }
    };

    function openWP() { document.getElementById('wpModal').style.display = "block"; }
    function closeWP() { document.getElementById('wpModal').style.display = "none"; }

    function setLang(lang) {
        currentLang = lang;
        document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById('btn-' + lang).classList.add('active');
        const t = translations[lang];
        document.getElementById('dev-tag').innerText = t.dev;
        document.getElementById('lbl-region').innerText = t.region;
        document.getElementById('lbl-sat').innerText = t.sat;
        document.getElementById('lbl-hotspot').innerText = t.hotspot;
        const openPopup = map._popup;
        if (openPopup && openPopup.options.dataRef) {
            openPopup.setContent(generatePopupContent(openPopup.options.dataRef, openPopup.options.idRef));
        }
    }

    const darkMap = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', { attribution: 'Ali Akbar' });
    const lightMap = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', { attribution: 'Ali Akbar' });
    const satelliteMap = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', { attribution: 'Esri' });

    const map = L.map('map', { zoomControl: false, layers: [darkMap] }).setView([4.3, 96.8], 7);
    L.control.layers({ "Dark": darkMap, "Light": lightMap, "Satelit": satelliteMap }, null, { position: 'topright' }).addTo(map);
    fireLayer.addTo(map);

    function generatePopupContent(d, id) {
        const t = translations[currentLang];
        let tempC = ((d.bright_ti4 || d.bright_t31 || 300) - 273.15).toFixed(1);
        let tStr = d.acq_time ? d.acq_time.toString().padStart(4, '0') : "0000";
        let date = new Date(d.acq_date + 'T' + tStr.substring(0, 2) + ':' + tStr.substring(2, 4) + ':00Z');
        date.setHours(date.getHours() + 7);
        let timeWIB = date.toLocaleString('id-ID', { day: '2-digit', month: 'short', hour: '2-digit', minute: '2-digit' }) + " WIB";

        return `<div style="min-width: 220px;">
            <h3 style="margin:0; color:var(--primary); font-size: 13px;">${t.detail}</h3>
            <span id="loc-${id}" style="color:#ffcc00; font-weight:bold; font-size:11px; margin-top:5px; display:block;">${t.loc_loading}</span>
            <hr style="border:0; border-top:1px solid #333; margin: 8px 0;">
            <table style="width:100%; font-size:11px; color:#ccc;">
                <tr><td>${t.temp}</td><td class="val">${tempC} Â°C</td></tr>
                <tr><td>${t.energy}</td><td class="val">${d.frp || 0} MW</td></tr>
                <tr><td>${t.time}</td><td class="val">${timeWIB}</td></tr>
            </table>
        </div>`;
    }

    async function fetchAddress(lat, lon, id) {
        const el = document.getElementById(`loc-${id}`);
        if (!el || el.getAttribute('data-loaded') === 'true') return;
        try {
            const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=12`);
            const data = await response.json();
            el.innerText = data.display_name.split(',').slice(0, 3).join(',');
            el.setAttribute('data-loaded', 'true');
        } catch (e) { el.innerText = "Lokasi terdeteksi"; }
    }

    async function updateData() {
        const sat = document.getElementById('sat-source').value;
        const wilayah = document.getElementById('region-select').value;
        document.getElementById('status').innerHTML = translations[currentLang].sync;
        fireLayer.clearLayers();
        try {
            const response = await fetch(`${gasApiUrl}?sat=${sat}&wilayah=${wilayah}`);
            const csvData = await response.text();
            Papa.parse(csvData, {
                header: true, skipEmptyLines: true, dynamicTyping: true,
                complete: function(res) {
                    let total = 0;
                    res.data.forEach((d, index) => {
                        if (d.latitude && d.longitude) {
                            let uniqueId = "fire-" + index;
                            let marker = L.circleMarker([d.latitude, d.longitude], {
                                radius: Math.min(Math.max((d.frp || 5) / 4, 5), 14), 
                                fillColor: "#ff0000", color: "#fff", weight: 0.5, fillOpacity: 0.8, className: 'glow-marker'
                            });
                            marker.bindPopup(generatePopupContent(d, uniqueId), { dataRef: d, idRef: uniqueId });
                            marker.on('click', () => setTimeout(() => fetchAddress(d.latitude, d.longitude, uniqueId), 100));
                            fireLayer.addLayer(marker);
                            total++;
                        }
                    });
                    document.getElementById('fire-count').innerText = total.toLocaleString();
                    document.getElementById('status').innerHTML = "Live <i class='fas fa-circle' style='color:#00ff00; font-size:8px'></i>";
                    if (wilayah === "aceh") map.flyTo([4.3, 96.8], 8);
                    else if (wilayah === "indonesia") map.flyTo([0.78, 113.9], 5);
                }
            });
        } catch (e) { document.getElementById('status').innerHTML = "Error"; }
    }
    window.onload = updateData;
</script>
</body>
</html>
