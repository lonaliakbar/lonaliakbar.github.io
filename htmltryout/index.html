<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>W3 Pro Editor - Minify Tools</title>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /* --- TEMA DRACULA & LAYOUT --- */
        :root {
            --bg-main: #282a36; 
            --bg-header: #1e1f29;
            --text-primary: #f8f8f2;
            --accent-green: #50fa7b;
            --accent-purple: #bd93f9;
            --accent-orange: #ffb86c;
            --accent-red: #ff5555;
            --accent-cyan: #8be9fd;
            --accent-pink: #ff79c6;
            --border-color: #44475a;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html { height: 100%; width: 100%; overflow: hidden; font-family: 'Inter', sans-serif; background: var(--bg-main); color: var(--text-primary); }

        /* --- TOOLBAR --- */
        .toolbar {
            height: 55px;
            background: var(--bg-header);
            border-bottom: 1px solid var(--border-color);
            display: flex; align-items: center; justify-content: space-between; padding: 0 10px;
            overflow-x: auto; /* Scroll jika layar sempit */
        }

        /* Branding */
        .brand { font-weight: 700; font-size: 1.1rem; display: flex; align-items: center; gap: 8px; white-space: nowrap; margin-right: 15px; }
        .brand span { color: var(--accent-green); background: rgba(80, 250, 123, 0.1); padding: 2px 6px; border-radius: 4px; font-family: 'Fira Code', monospace;}

        /* Grup Tombol */
        .actions { display: flex; gap: 6px; align-items: center; }
        
        .btn {
            border: none; padding: 8px 12px; border-radius: 6px; font-weight: 600; font-size: 0.85rem; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: all 0.2s; color: var(--text-primary); background: var(--border-color); white-space: nowrap;
        }
        .btn:hover { filter: brightness(1.2); transform: translateY(-1px); }
        .btn:active { transform: translateY(0); }
        
        /* Warna Khusus Tombol */
        .btn-run { background: var(--accent-green); color: #282a36; }
        .btn-save { background: var(--accent-purple); color: #282a36; }
        .btn-search { background: var(--accent-pink); color: #282a36; } /* Tombol Search */
        
        /* Tombol Lain */
        .btn-clear { border: 1px solid var(--accent-red); color: var(--accent-red); background: transparent; }
        .btn-reset { color: var(--accent-orange); background: transparent; }
        .btn-minify { background: var(--accent-cyan); color: #282a36; }
        .btn-format { background: #6272a4; color: white; }

        .icon { font-size: 1.1em; line-height: 1; }
        .divider { width: 1px; height: 25px; background: var(--border-color); margin: 0 5px; }

        /* --- WORKSPACE --- */
        .workspace { display: flex; height: calc(100% - 55px); position: relative; }
        #editor-pane { width: 50%; height: 100%; position: relative; }
        #ace-editor { position: absolute; top: 0; right: 0; bottom: 0; left: 0; font-family: 'Fira Code', monospace; font-size: 14px; }

        .resizer {
            width: 10px; height: 100%; background: var(--bg-header); border-left: 1px solid var(--border-color); border-right: 1px solid var(--border-color); cursor: col-resize; display: flex; align-items: center; justify-content: center; z-index: 10;
        }
        .resizer::after { content: "‚ãÆ"; color: #6272a4; }
        
        #preview-pane { flex: 1; height: 100%; background: white; display: flex; flex-direction: column; position: relative; }
        .pane-header { background: #eee; color: #333; padding: 5px 10px; font-size: 0.75rem; font-weight: bold; border-bottom: 1px solid #ccc; display: flex; justify-content: space-between; }
        iframe { flex: 1; width: 100%; border: none; }
        #iframe-overlay { position: absolute; top:0; left:0; right:0; bottom:0; background: transparent; z-index: 20; display: none; }

        /* Responsive */
        @media (max-width: 768px) {
            .workspace { flex-direction: column; }
            #editor-pane { width: 100% !important; height: 50%; }
            .resizer { width: 100%; height: 12px; cursor: row-resize; border: none; border-top: 1px solid var(--border-color); border-bottom: 1px solid var(--border-color); }
            .resizer::after { content: "‚ãØ"; font-size: 18px; line-height: 0; }
            .btn span.text { display: none; } /* Icon only on mobile */
            .btn { padding: 8px 10px; }
        }
    </style>
</head>
<body>

    <header class="toolbar">
        <div class="brand">
            <span>W3</span> Pro
        </div>
        <div class="actions">
            <button class="btn btn-clear" onclick="clearCode()" title="Kosongkan Editor">
                <span class="icon">üóë</span> <span class="text">Clear</span>
            </button>
            
            <button class="btn btn-reset" onclick="resetCode()" title="Reset ke Awal">
                <span class="icon">‚Ü∫</span> <span class="text">Reset</span>
            </button>
            
            <div class="divider"></div>

            <button class="btn btn-search" onclick="triggerSearch()" title="Cari (Ctrl+F)">
                <span class="icon">üîç</span> <span class="text">Search</span>
            </button>

            <button class="btn btn-minify" onclick="minifyCode()" title="Padatkan Kode">
                <span class="icon">üì¶</span> <span class="text">Minify</span>
            </button>
            
            <button class="btn btn-format" onclick="formatCode()" title="Rapikan Kode">
                <span class="icon">üßπ</span> <span class="text">Format</span>
            </button>

            <div class="divider"></div>

            <button class="btn btn-save" onclick="saveCode()" title="Simpan File">
                <span class="icon">üíæ</span> <span class="text">Save</span>
            </button>
            
            <button class="btn btn-run" onclick="runCode()" title="Jalankan">
                <span class="icon">‚ñ∂</span> <span class="text">Run</span>
            </button>
        </div>
    </header>

    <div class="workspace" id="workspace">
        <div id="editor-pane">
            <div id="ace-editor"></div>
        </div>
        <div class="resizer" id="resizer"></div>
        <div id="preview-pane">
            <div class="pane-header">PREVIEW</div>
            <div id="iframe-overlay"></div> 
            <iframe id="preview-frame"></iframe>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.14/ace.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.14/ext-language_tools.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.14/ext-beautify.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.14/ext-searchbox.min.js"></script>

    <script>
        const initialCode = `<!DOCTYPE html>
<html>
<head>
<style>
  body { 
    font-family: sans-serif; 
    background: #f4f4f9; 
    text-align: center; 
    padding: 50px; 
  }
  .card {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    display: inline-block;
  }
</style>
</head>
<body>

<div class="card">
  <h1>Halo!</h1>
  <p>Coba klik tombol <b>Search</b> di atas.</p>
  <p>Kotak pencarian akan muncul (sama seperti Ctrl+F).</p>
  <button onclick="alert('Berhasil')">Klik Saya</button>
</div>

<script>
  // Ini fungsi javascript
  console.log("Sistem siap...");
<\/script>

</body>
</html>`;

        // SETUP ACE EDITOR
        ace.require("ace/ext/language_tools");
        // Memastikan searchbox di-load
        ace.require("ace/ext/searchbox");
        
        const editor = ace.edit("ace-editor");
        editor.setTheme("ace/theme/dracula");
        editor.session.setMode("ace/mode/html");
        editor.setOptions({
            enableBasicAutocompletion: true,
            enableLiveAutocompletion: true,
            fontSize: "14px",
            wrap: true,
            tabSize: 2
        });
        editor.setValue(initialCode, -1);

        // --- FUNGSI 1: KOSONGKAN (CLEAR) ---
        function clearCode() {
            if(confirm("Hapus seluruh kode dan mulai dari nol?")) {
                editor.setValue("", -1);
                editor.focus();
            }
        }

        // --- FUNGSI 2: RESET ---
        function resetCode() {
            if(confirm("Kembalikan ke kode template awal?")) {
                editor.setValue(initialCode, -1);
                runCode();
            }
        }

        // --- FUNGSI 3: SEARCH (SAMA SEPERTI CTRL+F) ---
        function triggerSearch() {
            // Perintah "find" adalah command internal Ace Editor untuk Ctrl+F
            // Ini akan memunculkan UI searchbox bawaan
            editor.execCommand("find");
        }

        // --- FUNGSI 4: MINIFY (PADATKAN) ---
        function minifyCode() {
            let code = editor.getValue();
            
            // Regex Sederhana untuk Minify
            code = code.replace(/\/\*[\s\S]*?\*\//g, ""); // Hapus komentar /* */
            code = code.replace(/\s+/g, " "); // Hapus spasi berlebih
            code = code.replace(/>\s+</g, "><"); // Hapus spasi antar tag
            code = code.replace(/\s*{\s*/g, "{"); // CSS/JS bracket
            code = code.replace(/\s*}\s*/g, "}");
            code = code.replace(/\s*;\s*/g, ";");
            code = code.replace(/\s*:\s*/g, ":");

            editor.setValue(code, -1);
            runCode(); 
        }

        // --- FUNGSI 5: FORMAT (BEAUTIFY) ---
        function formatCode() {
            const beautify = ace.require("ace/ext/beautify");
            beautify.beautify(editor.session);
        }

        // FUNGSI RUN
        function runCode() {
            const code = editor.getValue();
            const frame = document.getElementById('preview-frame');
            frame.src = 'about:blank'; 
            setTimeout(() => {
                const doc = frame.contentDocument || frame.contentWindow.document;
                doc.open(); doc.write(code); doc.close();
            }, 10);
        }

        // FUNGSI SAVE
        async function saveCode() {
            const code = editor.getValue();
            const blob = new Blob([code], { type: "text/html" });
            if (window.showSaveFilePicker) {
                try {
                    const handle = await window.showSaveFilePicker({
                        suggestedName: 'index.html',
                        types: [{ description: 'HTML File', accept: {'text/html': ['.html']} }],
                    });
                    const writable = await handle.createWritable();
                    await writable.write(blob); await writable.close();
                    return;
                } catch (err) {}
            }
            const fileName = prompt("Simpan sebagai:", "index.html");
            if (fileName) {
                const link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = fileName.endsWith('.html') ? fileName : fileName + '.html';
                link.click();
            }
        }

        // RESIZER LOGIC (Agar panel bisa digeser)
        const resizer = document.getElementById('resizer');
        const editorPane = document.getElementById('editor-pane');
        const workspace = document.getElementById('workspace');
        const iframeOverlay = document.getElementById('iframe-overlay');
        let isResizing = false;

        resizer.addEventListener('mousedown', () => { isResizing = true; iframeOverlay.style.display = 'block'; });
        resizer.addEventListener('touchstart', () => { isResizing = true; iframeOverlay.style.display = 'block'; });

        const resizeMove = (e) => {
            if (!isResizing) return;
            const isMobile = window.innerWidth <= 768;
            let percent;
            if (isMobile) {
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                percent = ((clientY - 55) / workspace.offsetHeight) * 100;
                editorPane.style.height = `${percent}%`;
            } else {
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                percent = (clientX / workspace.offsetWidth) * 100;
                editorPane.style.width = `${percent}%`;
            }
            editor.resize();
        };

        window.addEventListener('mousemove', resizeMove);
        window.addEventListener('touchmove', resizeMove);
        window.addEventListener('mouseup', () => { isResizing = false; iframeOverlay.style.display = 'none'; });
        window.addEventListener('touchend', () => { isResizing = false; iframeOverlay.style.display = 'none'; });

        // Run pertama kali
        runCode();
    </script>
</body>
</html>
