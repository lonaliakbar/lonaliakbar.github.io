<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rekapitulasi Suara - Real Tally</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Architects+Daughter&family=Roboto:wght@400;700;900&family=Times+New+Roman&display=swap');
        :root {
            --kpu-red: #e4032a; --kpu-black: #222222; --paper-bg: #f5f5f5;
            --border-color: #cccccc; --text-color: #333333; --success-green: #28a745;
            --invalid-gray: #6c757d;
            --winner-gold: #ffd700; --tie-silver: #c0c0c0;
        }
        html, body {
            height: 100%; margin: 0; overflow: hidden;
            font-family: 'Roboto', sans-serif; background-color: #e0e0e0;
        }
        
        /* PENYESUAIAN: Margin luar diperkecil untuk tampilan full-screen */
        .page-container {
            width: calc(100% - 20px); height: calc(100% - 20px); margin: 10px;
            background-color: var(--paper-bg); border: 3px double var(--kpu-black);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); box-sizing: border-box;
            display: flex; flex-direction: column;
        }
        
        header {
            padding: 12px 25px; /* PENYESUAIAN: Padding dikurangi */
            border-bottom: 2px solid var(--kpu-black);
            flex-shrink: 0; background-color: #ffffff; position: relative;
            min-height: 130px; /* PENYESUAIAN: Tinggi minimal dikurangi */
            max-height: 400px;
            display: flex; flex-direction: column; justify-content: center;
        }
        header::after { content: ''; position: absolute; bottom: -4px; left: 0; right: 0; height: 8px; cursor: ns-resize; }
        
        footer {
            padding: 12px; /* PENYESUAIAN: Padding dikurangi */
            text-align: center; border-top: 2px solid var(--kpu-black);
            flex-shrink: 0; background-color: #ffffff; position: relative;
            min-height: 85px; /* PENYESUAIAN: Tinggi minimal dikurangi */
            max-height: 400px;
        }
        footer::before { content: ''; position: absolute; top: -4px; left: 0; right: 0; height: 8px; cursor: ns-resize; }

        .header-top { display: flex; align-items: center; }
        .logo { height: 60px; width: 60px; margin-right: 20px; flex-shrink: 0; }
        .header-text { text-align: left; flex-grow: 1; }
        .main-title { font-family: 'Times New Roman', serif; margin: 0; font-weight: 700; transition: font-size 0.1s; }
        .subtitle { color: #666; margin: 0; transition: font-size 0.1s; }
        [contenteditable="true"]:focus, [contenteditable="true"]:hover { background-color: #fffde7; outline: 1px dashed var(--kpu-red); border-radius: 3px; }
        
        /* PENYESUAIAN: Jarak panel ringkasan dikurangi */
        .summary-panel { display: flex; justify-content: space-around; flex-wrap: wrap; margin-top: 10px; padding-top: 10px; border-top: 1px dashed var(--border-color); }
        .summary-item { text-align: center; padding: 5px 10px; }
        .summary-label { font-size: 0.9rem; color: #555; font-weight: 700; }
        .summary-value { font-size: 2.2rem; font-weight: 900; line-height: 1.2; margin-top: 5px; color: var(--kpu-black); }
        #total-voters { color: var(--kpu-red); padding: 0 10px; border-radius: 5px; cursor: pointer; }
        
        /* PENYESUAIAN: Padding area utama dikurangi */
        .ballot-area { flex-grow: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 15px; }
        .candidate-entry { display: flex; align-items: stretch; border: 3px solid transparent; border-radius: 5px; background-color: #ffffff; transition: all 0.3s; }
        .candidate-entry:hover { box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .candidate-number { font-size: 2.5rem; font-weight: 700; color: var(--kpu-red); padding: 0 25px; display: flex; align-items: center; justify-content: center; border-right: 1px solid var(--border-color); background-color: #fafafa; }
        .candidate-entry.invalid-votes .candidate-number { color: var(--invalid-gray); }
        .candidate-entry.invalid-votes .tally-five-group::after { background-color: var(--invalid-gray); }
        .candidate-info { padding: 15px; flex-grow: 1; }
        .candidate-name { font-size: 1.5rem; font-weight: 700; margin: 0 0 10px 0; }
        .tally-display { font-family: 'Architects Daughter', cursive; color: #444; font-size: 2.2rem; word-break: break-all; letter-spacing: 2px; min-height: 40px; }
        .tally-five-group { position: relative; display: inline-block; padding: 0 8px 0 2px; color: #333; }
        .tally-five-group::after { content: ''; position: absolute; top: 50%; left: -5%; width: 110%; height: 4px; background-color: var(--kpu-red); transform: rotate(-15deg); border-radius: 2px; }
        .vote-controls { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 15px; border-left: 1px solid var(--border-color); gap: 10px; }
        .vote-count { font-size: 2.5rem; font-weight: 700; color: var(--kpu-black); }
        .action-buttons { display: flex; gap: 10px; }
        .btn { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--border-color); background-color: #f0f0f0; font-size: 1.5rem; font-weight: 700; cursor: pointer; transition: all 0.2s; }
        .btn-add { color: var(--success-green); }
        .btn-add:hover { background-color: var(--success-green); color: white; border-color: var(--success-green); }
        .btn-remove { color: var(--kpu-red); }
        .btn-remove:hover { background-color: var(--kpu-red); color: white; border-color: var(--kpu-red); }
        .footer-btn { font-size: 0.9rem; padding: 10px 25px; border-radius: 5px; border: 1px solid var(--kpu-black); color: var(--kpu-black); background-color: transparent; font-weight: 700; cursor: pointer; margin: 0 10px; transition: all 0.3s; }
        .footer-btn:hover { background-color: var(--kpu-black); color: white; }
        .footer-credit { margin-top: 15px; font-size: 0.8rem; color: #777777; }

        .winner-highlight { border: 3px solid var(--winner-gold); box-shadow: 0 0 15px var(--winner-gold); }
        .tie-highlight { border: 3px solid var(--tie-silver); box-shadow: 0 0 15px var(--tie-silver); }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); display: none; align-items: center; justify-content: center; z-index: 1000; animation: fadeIn 0.3s ease; }
        .modal-content { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 5px 25px rgba(0,0,0,0.4); width: 90%; max-width: 700px; text-align: center; animation: slideIn 0.4s ease-out; }
        .modal-header { position: relative; border-bottom: 2px solid #eee; padding-bottom: 15px; margin-bottom: 20px; }
        .modal-header h2 { margin: 0; color: var(--kpu-black); font-family: 'Times New Roman', serif; }
        .close-btn { position: absolute; top: -15px; right: -10px; font-size: 2.5rem; font-weight: bold; color: #aaa; cursor: pointer; transition: color 0.2s; }
        .close-btn:hover { color: var(--kpu-red); }
        .winner-title { font-size: 1.2rem; font-weight: 700; color: var(--invalid-gray); text-transform: uppercase; }
        .winner-name { font-size: 2.5rem; font-weight: 900; color: var(--kpu-red); margin: 10px 0; }
        .winner-stats { font-size: 1rem; color: #555; margin-bottom: 25px; }
        #full-results-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        #full-results-table th, #full-results-table td { padding: 10px; border: 1px solid #ddd; text-align: left; }
        #full-results-table th { background-color: #f8f8f8; font-weight: 700; }
        #full-results-table td:nth-child(2), #full-results-table td:nth-child(3) { text-align: right; font-weight: bold; }
        .modal-footer { margin-top: 30px; border-top: 2px solid #eee; padding-top: 20px; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        @media print {
            body > *:not(.printable-area) { display: none !important; }
            .printable-area { display: block !important; position: absolute; top: 0; left: 0; width: 100%; }
        }
    </style>
</head>
<body>
    <div class="page-container">
        <header id="header">
            <div class="header-top">
                <svg class="logo" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-label="Ikon Pemungutan Suara"><path d="M7 12L10 15L17 8" stroke="var(--kpu-red)" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M4 4H20V16C20 17.1046 19.1046 18 18 18H6C4.89543 18 4 17.1046 4 16V4Z" stroke="var(--kpu-black)" stroke-width="2"/><path d="M9 4V2" stroke="var(--kpu-black)" stroke-width="2" stroke-linecap="round"/><path d="M15 4V2" stroke="var(--kpu-black)" stroke-width="2" stroke-linecap="round"/><path d="M4 20H20" stroke="var(--kpu-black)" stroke-width="2" stroke-linecap="round"/></svg>
                <div class="header-text">
                    <h1 id="main-title" class="main-title" contenteditable="true">REKAPITULASI HASIL PENGHITUNGAN SUARA</h1>
                    <p id="subtitle" class="subtitle" contenteditable="true">PEMILIHAN UMUM TAHUN 2025</p>
                </div>
            </div>
            <div class="summary-panel">
                <div class="summary-item"><div class="summary-label">JUMLAH PEMILIH (DPT)</div><div id="total-voters" class="summary-value" contenteditable="true" title="Klik untuk mengubah">100</div></div>
                <div class="summary-item"><div class="summary-label">TOTAL SUARA MASUK</div><div id="total-votes-cast" class="summary-value">0</div></div>
                <div class="summary-item"><div class="summary-label">SUARA TIDAK SAH</div><div id="invalid-votes-summary" class="summary-value" style="color: var(--invalid-gray);">0</div></div>
                <div class="summary-item"><div class="summary-label">SISA SUARA</div><div id="remaining-votes" class="summary-value">100</div></div>
            </div>
        </header>
        <main id="ballot-area" class="ballot-area"></main>
        <footer id="footer">
            <button id="add-candidate-btn" class="footer-btn">Tambah Calon/Opsi</button>
            <button id="reset-all-btn" class="footer-btn">Reset Semua Suara</button>
            <p class="footer-credit">Aplikasi Real Tally oleh Ali Akbar</p>
        </footer>
    </div>

    <div id="results-modal" class="modal-overlay">
        <div id="modal-content" class="modal-content">
            <div class="modal-header"><h2>HASIL AKHIR PENGHITUNGAN SUARA</h2><span id="close-modal-btn" class="close-btn">&times;</span></div>
            <div class="modal-body">
                <div id="winner-announcement"><div id="winner-title" class="winner-title"></div><div id="winner-name" class="winner-name"></div><div class="winner-stats">Memperoleh <strong id="winner-votes">0</strong> Suara (<strong id="winner-percentage">0.0%</strong>)</div></div>
                <h3 style="margin: 30px 0 10px 0; text-align: left; color: #333;">Rincian Lengkap:</h3>
                <div id="full-results-table"></div>
            </div>
            <div class="modal-footer"><button id="print-results-btn" class="footer-btn">🖨️ Cetak Hasil</button><button id="download-image-btn" class="footer-btn">🖼️ Unduh sebagai Gambar</button></div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const pageContainer = document.querySelector('.page-container');
        const header = document.getElementById('header');
        const footer = document.getElementById('footer');
        const ballotArea = document.getElementById('ballot-area');
        const mainTitleEl = document.getElementById('main-title');
        const subtitleEl = document.getElementById('subtitle');
        const addCandidateBtn = document.getElementById('add-candidate-btn');
        const resetAllBtn = document.getElementById('reset-all-btn');
        const totalVotersEl = document.getElementById('total-voters');
        const totalVotesCastEl = document.getElementById('total-votes-cast');
        const remainingVotesEl = document.getElementById('remaining-votes');
        const invalidVotesSummaryEl = document.getElementById('invalid-votes-summary');
        const modal = document.getElementById('results-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const printBtn = document.getElementById('print-results-btn');
        const downloadBtn = document.getElementById('download-image-btn');

        let candidates = [];
        let invalidVotes = 0;
        let finalResultsAnnounced = false;

        const updateHeaderFonts = (currentHeight) => {
            const minHeight = 130, maxHeight = 400;
            const minTitleSize = 1.6, maxTitleSize = 3.2;
            const minSubtitleSize = 1.0, maxSubtitleSize = 1.5;
            const clampedHeight = Math.max(minHeight, Math.min(currentHeight, maxHeight));
            const percentage = (clampedHeight - minHeight) / (maxHeight - minHeight);
            const newTitleSize = minTitleSize + (maxTitleSize - minTitleSize) * percentage;
            const newSubtitleSize = minSubtitleSize + (maxSubtitleSize - minSubtitleSize) * percentage;
            mainTitleEl.style.fontSize = `${newTitleSize}rem`;
            subtitleEl.style.fontSize = `${newSubtitleSize}rem`;
        };

        const makeResizable = (element, handleEdge, onResize) => {
            let isResizing = false;
            element.addEventListener('mousedown', (e) => {
                const isHandle = handleEdge === 'top' ? (e.offsetY < 8) : (e.offsetY > element.clientHeight - 8);
                if (isHandle) {
                    isResizing = true;
                    document.body.style.cursor = 'ns-resize';
                    document.body.style.userSelect = 'none';
                }
            });
            window.addEventListener('mousemove', (e) => {
                if (!isResizing) return;
                const containerRect = pageContainer.getBoundingClientRect();
                let newHeight;
                if (handleEdge === 'top') {
                    newHeight = containerRect.bottom - e.clientY;
                } else {
                    newHeight = e.clientY - containerRect.top;
                }
                const minHeight = parseInt(getComputedStyle(element).minHeight);
                const maxHeight = parseInt(getComputedStyle(element).maxHeight);
                newHeight = Math.max(minHeight, Math.min(newHeight, maxHeight));
                element.style.height = `${newHeight}px`;
                if(onResize) onResize(newHeight);
            });
            window.addEventListener('mouseup', () => {
                if(isResizing) {
                    isResizing = false;
                    document.body.style.cursor = 'default';
                    document.body.style.userSelect = 'auto';
                    saveState();
                }
            });
        };
        
        makeResizable(header, 'bottom', updateHeaderFonts);
        makeResizable(footer, 'top', null);

        const saveState = () => {
            const state = { 
                candidates, invalidVotes,
                title: mainTitleEl.textContent,
                subtitle: subtitleEl.textContent,
                totalVoters: parseInt(totalVotersEl.textContent) || 0,
                headerHeight: header.offsetHeight,
                footerHeight: footer.offsetHeight
            };
            localStorage.setItem('kpuTallyState', JSON.stringify(state));
        };

        const loadState = () => {
            const savedState = localStorage.getItem('kpuTallyState');
            if (savedState) {
                const state = JSON.parse(savedState);
                candidates = state.candidates || [];
                invalidVotes = state.invalidVotes || 0;
                mainTitleEl.textContent = state.title || 'REKAPITULASI HASIL PENGHITUNGAN SUARA';
                subtitleEl.textContent = state.subtitle || 'PEMILIHAN UMUM TAHUN 2025';
                totalVotersEl.textContent = state.totalVoters || 100;
                if (state.headerHeight) {
                    header.style.height = `${state.headerHeight}px`;
                    updateHeaderFonts(state.headerHeight);
                } else {
                    updateHeaderFonts(header.offsetHeight);
                }
                if (state.footerHeight) footer.style.height = `${state.footerHeight}px`;
            } else {
                candidates = [{ id: Date.now(), name: 'NAMA CALON SATU', votes: 0 }, { id: Date.now() + 1, name: 'NAMA CALON DUA', votes: 0 }];
                invalidVotes = 0;
                updateHeaderFonts(header.offsetHeight);
            }
            renderAll();
        };

        const updateSummary = () => {
            const totalVoters = parseInt(totalVotersEl.textContent) || 0;
            const totalValidVotes = candidates.reduce((sum, candidate) => sum + candidate.votes, 0);
            const totalVotesCast = totalValidVotes + invalidVotes;
            const remainingVotes = totalVoters - totalVotesCast;
            totalVotesCastEl.textContent = totalVotesCast;
            invalidVotesSummaryEl.textContent = invalidVotes;
            remainingVotesEl.textContent = remainingVotes;
            if (remainingVotes <= 0 && !finalResultsAnnounced && totalVotesCast > 0) {
                triggerFinalAnnouncement();
            }
        };
        const generateTallyHTML = (count) => {
            if (count === 0) return '<span style="font-family: Roboto, sans-serif; font-size: 1rem; color: #aaa;">Belum ada suara</span>';
            let html = '';
            const fullGroups = Math.floor(count / 5);
            const remainder = count % 5;
            for (let i = 0; i < fullGroups; i++) { html += '<span class="tally-five-group">||||</span>'; }
            if (remainder > 0) { html += '|'.repeat(remainder); }
            return html;
        };
        const renderAll = () => {
            ballotArea.innerHTML = '';
            candidates.forEach((candidate, index) => {
                const entry = document.createElement('div');
                entry.className = 'candidate-entry';
                entry.setAttribute('data-id', candidate.id);
                entry.innerHTML = `<div class="candidate-number">${index + 1}</div><div class="candidate-info"><h2 class="candidate-name" contenteditable="true">${candidate.name}</h2><div class="tally-display">${generateTallyHTML(candidate.votes)}</div></div><div class="vote-controls"><div class="vote-count">${candidate.votes}</div><div class="action-buttons"><button class="btn btn-remove" title="Kurangi 1 suara">-</button><button class="btn btn-add" title="Tambah 1 suara">+</button></div></div>`;
                ballotArea.appendChild(entry);
            });
            const invalidEntry = document.createElement('div');
            invalidEntry.className = 'candidate-entry invalid-votes';
            invalidEntry.id = 'invalid-votes-entry';
            invalidEntry.innerHTML = `<div class="candidate-number">!</div><div class="candidate-info"><h2 class="candidate-name">SUARA TIDAK SAH / RUSAK</h2><div class="tally-display">${generateTallyHTML(invalidVotes)}</div></div><div class="vote-controls"><div class="vote-count">${invalidVotes}</div><div class="action-buttons"><button class="btn btn-remove" title="Kurangi 1 suara tidak sah">-</button><button class="btn btn-add" title="Tambah 1 suara tidak sah">+</button></div></div>`;
            ballotArea.appendChild(invalidEntry);
            updateSummary();
        };
        const getWinnerInfo = () => {
            const totalValidVotes = candidates.reduce((sum, c) => sum + c.votes, 0);
            if (candidates.length === 0 || totalValidVotes === 0) { return { title: 'HASIL AKHIR', names: 'Tidak ada suara sah', winners: [], votes: 0, percentage: 0 }; }
            const maxVotes = Math.max(...candidates.map(c => c.votes));
            if (maxVotes === 0) { return { title: 'HASIL AKHIR', names: 'Tidak ada suara sah', winners: [], votes: 0, percentage: 0 }; }
            const winners = candidates.filter(c => c.votes === maxVotes);
            const percentage = ((maxVotes / totalValidVotes) * 100).toFixed(1);
            if (winners.length === 1) { return { title: 'PEMENANG', names: winners[0].name.toUpperCase(), winners, votes: maxVotes, percentage }; } 
            else { return { title: 'HASIL SERI', names: winners.map(w => w.name.toUpperCase()).join(' & '), winners, votes: maxVotes, percentage }; }
        };
        const triggerFinalAnnouncement = () => {
            finalResultsAnnounced = true;
            const result = getWinnerInfo();
            document.getElementById('winner-title').textContent = result.title;
            document.getElementById('winner-name').textContent = result.names;
            document.getElementById('winner-votes').textContent = result.votes;
            document.getElementById('winner-percentage').textContent = result.percentage + '% dari suara sah';
            const totalValidVotes = candidates.reduce((sum, c) => sum + c.votes, 0);
            let tableHTML = '<table id="full-results-table"><thead><tr><th>Nama Calon/Opsi</th><th>Suara</th><th>Persentase</th></tr></thead><tbody>';
            candidates.forEach(c => {
                const perc = totalValidVotes > 0 ? ((c.votes / totalValidVotes) * 100).toFixed(1) + '%' : '0.0%';
                tableHTML += `<tr><td>${c.name}</td><td>${c.votes}</td><td>${perc}</td></tr>`;
            });
            tableHTML += '</tbody></table>';
            document.getElementById('full-results-table').innerHTML = tableHTML;
            highlightWinnersInList(result.winners, result.title);
            modal.style.display = 'flex';
            confetti({ particleCount: 150, spread: 90, origin: { y: 0.6 } });
        };
        const highlightWinnersInList = (winners, title) => {
            const highlightClass = title === 'PEMENANG' ? 'winner-highlight' : 'tie-highlight';
            const winnerIds = winners.map(w => w.id);
            document.querySelectorAll('.candidate-entry[data-id]').forEach(entry => {
                if (winnerIds.includes(Number(entry.dataset.id))) { entry.classList.add(highlightClass); }
            });
        };
        const resetHighlights = () => { document.querySelectorAll('.winner-highlight, .tie-highlight').forEach(el => { el.classList.remove('winner-highlight', 'tie-highlight'); }); };
        const handleBallotAreaClick = (e) => {
            const target = e.target;
            const entry = target.closest('.candidate-entry');
            if (!entry) return;
            const isAdd = target.classList.contains('btn-add');
            const isRemove = target.classList.contains('btn-remove');
            if (!isAdd && !isRemove) return;
            if (isAdd && (parseInt(remainingVotesEl.textContent) || 0) <= 0) { alert("Batas jumlah pemilih sudah tercapai."); return; }
            if (entry.id === 'invalid-votes-entry') {
                if (isAdd) invalidVotes++;
                else if (isRemove && invalidVotes > 0) invalidVotes--;
            } else {
                const id = Number(entry.getAttribute('data-id'));
                const candidate = candidates.find(c => c.id === id);
                if (candidate) {
                    if (isAdd) candidate.votes++;
                    else if (isRemove && candidate.votes > 0) candidate.votes--;
                }
            }
            saveState();
            renderAll();
        };
        const handleTextChange = (e) => {
            const target = e.target;
            if (target.classList.contains('candidate-name')) {
                const id = Number(target.closest('.candidate-entry').getAttribute('data-id'));
                const candidate = candidates.find(c => c.id === id);
                if (candidate && candidate.name !== target.textContent) {
                    candidate.name = target.textContent;
                    saveState();
                }
            }
        };
        const addNewCandidate = () => {
            const name = prompt("Masukkan Nama Calon/Opsi Baru:", `CALON ${candidates.length + 1}`);
            if (name && name.trim() !== '') {
                candidates.push({ id: Date.now(), name: name.trim().toUpperCase(), votes: 0 });
                saveState();
                renderAll();
            }
        };
        const resetAllVotes = () => {
            if (confirm('PERINGATAN: Anda akan mereset JUMLAH SUARA semua calon dan SUARA TIDAK SAH menjadi 0. Lanjutkan?')) {
                candidates.forEach(c => c.votes = 0);
                invalidVotes = 0;
                finalResultsAnnounced = false;
                resetHighlights();
                saveState();
                renderAll();
            }
        };
        
        ballotArea.addEventListener('click', handleBallotAreaClick);
        ballotArea.addEventListener('input', handleTextChange);
        mainTitleEl.addEventListener('focusout', saveState);
        subtitleEl.addEventListener('focusout', saveState);
        totalVotersEl.addEventListener('focusout', () => { updateSummary(); saveState(); });
        addCandidateBtn.addEventListener('click', addNewCandidate);
        resetAllBtn.addEventListener('click', resetAllVotes);
        closeModalBtn.addEventListener('click', () => modal.style.display = 'none');
        modal.addEventListener('click', (e) => { if (e.target === modal) modal.style.display = 'none'; });
        downloadBtn.addEventListener('click', () => {
            const modalContent = document.getElementById('modal-content');
            html2canvas(modalContent, { scale: 2 }).then(canvas => {
                const link = document.createElement('a');
                link.download = `hasil-akhir-${mainTitleEl.textContent.toLowerCase().replace(/\s/g, '_')}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        });
        printBtn.addEventListener('click', () => {
            const modalContent = document.getElementById('modal-content');
            modalContent.classList.add('printable-area');
            window.print();
            modalContent.classList.remove('printable-area');
        });

        loadState();
    });
    </script>
</body>
</html>
